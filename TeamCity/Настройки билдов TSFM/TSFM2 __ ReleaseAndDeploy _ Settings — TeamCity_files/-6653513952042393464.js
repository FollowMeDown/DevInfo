
/*---
/js/bs/blocks.js
---*/
BS.Blocks=Class.create({_blocks:{},blocksType:"",collapsedByDefault:true,mustPersistState:true,initialize:function(){this._blocks={};},getBlockContentElement:function(a){},onHideBlock:function(a,b){},onShowBlock:function(a,b){},toggleBlock:function(b,a){this._realToggle(b,a);this._saveState();},restoreSavedBlocks:function(){if(!this.mustPersistState){return;}var b=BS.Blocks._saved[this.blocksType];if(!b){return;}var c=b.split(":");for(var a=0;a<c.length;a++){if(c[a]&&c[a]!="null"){this.changeState(c[a],true,this.collapsedByDefault);}}},_saveState:function(){if(!this.mustPersistState){return;}var b="";for(var a in this._blocks){b+=a+":";}BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"blocksType="+this.blocksType+"&state="+b});},_realToggle:function(d,a,b){b=b||"";var c=this.getBlockContentElement(d);if(!c){return;}BS.blockRefreshTemporary();if(b=="collapse"||this.isVisible(c)){this.changeState(d,a,false);}else{if(b=="expand"||!this.isVisible(c)){this.changeState(d,a,true);}}c=null;},isExpanded:function(b){var a=this.getBlockContentElement(b);if(!a){return false;}return this.isVisible(a);},changeState:function(d,a,b){var c=this.getBlockContentElement(d);if(!c){return;}if(b){this.doShow(d,c);if(this.collapsedByDefault){this._addBlockData(d);}else{this._deleteBlockData(d);}this.onShowBlock(c,d);}else{this.doHide(d,c);if(this.collapsedByDefault){this._deleteBlockData(d);}else{this._addBlockData(d);}this.onHideBlock(c,d);}},isVisible:function(a){return BS.Util.visible(a);},doShow:function(b,a){BS.Util.show(a);},doHide:function(b,a){BS.Util.hide(a);},_addBlockData:function(a){this._blocks[a]=true;},_deleteBlockData:function(a){delete this._blocks[a];}});BS.Blocks._saved={};BS.BaseMultiElementBlocks=new (Class.create(BS.Blocks,{collapsedIcon:"",expandedIcon:"",iterateHandles:function(b,a){},iterateBlocks:function(a){},collapseAll:function(){var a=this;this.iterateBlocks(function(b){if(a.isExpanded(b)){a._realToggle(b,true,"collapse");}});this._saveState();},expandAll:function(){var a=this;this.iterateBlocks(function(b){if(!a.isExpanded(b)){a._realToggle(b,true,"expand");}});this._saveState();},isVisible:function(a){return a.length&&BS.Util.visible(a[0]);},doShow:function(c,a){a.each(function(){BS.Util.show(this);});var b=this;this.iterateHandles(c,function(d){if(d){d.src=window["base_uri"]+b.expandedIcon;}});},doHide:function(c,a){a.each(function(){BS.Util.hide(this);});var b=this;this.iterateHandles(c,function(d){if(d){d.src=window["base_uri"]+b.collapsedIcon;}});}}))();;
/*---
/js/bs/blocksWithHeader.js
---*/
BS.BlocksWithHeader=Class.create(BS.Blocks,{blocksType:"blocks",collapsedByDefault:false,initialize:function($super,b,c){$super();this.blocksType="Block_"+b;var a=$(b);if(!a){return;}this.headerId=b;if(!a.title&&a.className.indexOf("no_title")==-1){a.title="Click to expand/collapse this block";}this.collapsedByDefault=a.className.indexOf("expanded")==-1;a.on("click",this._onclick.bindAsEventListener(this));a=null;this.changeState(b,true,!this.collapsedByDefault);if(!c){this.restoreSavedBlocks();}},getId:function(){return this.headerId;},show:function(){this.changeState(this.headerId,true,true);this._saveState();},_onclick:function(a){this.toggleBlock(this.headerId,false);},getBlockContentElement:function(c){var b=$(c);if(!b||!b.parentNode){return;}$(b.parentNode).cleanWhitespace();var a=b.nextSibling;if(!a){alert("No contentDiv for "+b.id);}return a;},onHideBlock:function(a,b){b=$(b);b.addClassName("collapsed");b.removeClassName("expanded");},onShowBlock:function(a,b){b=$(b);b.addClassName("expanded");b.removeClassName("collapsed");}});;
/*---
/js/bs/blockWithHandle.js
---*/
BS.BlockWithHandle=Class.create(BS.Blocks,{isRetina:Retina.isRetina(),initialize:function($super,c,b,e,d){var a;$super();this.blocksType=c+b;this.blockId=b;this.collapsedByDefault=e;if(!(a=this.getHandle())){return;}this._cssOnly=a.hasClassName("handle_collapsed")||a.hasClassName("handle_expanded");this.getHandle().on("mousedown",function(f){Event.stop(f);});this.getHandle().on("click",this.toggle.bindAsEventListener(this));if(!d){this.changeState(this.blockId,true,!this.collapsedByDefault);this.restoreSavedBlocks();}},getId:function(){return this.blockId;},getHandle:function(){return $("blockHandle"+this.blockId);},toggle:function(){if(!this.getBlockContentElement(this.blockId)){this.getHandle().hide();return;}BS.blockRefreshTemporary();this.getHandle().show();if(this._cssOnly&&this.getHandle().hasClassName("handle_expanded")){this.hideBlock();}else{if(!this._cssOnly&&this.getHandle().getStyle("background-image").indexOf("img/"+this.collapsedIcon())<0){this.hideBlock();}else{this.showBlock();}}},showBlock:function(){this.changeState(this.blockId,true,true);this._saveState();},hideBlock:function(){this.changeState(this.blockId,true,false);this._saveState();},onHideBlock:function(){if(this._cssOnly){this.getHandle().removeClassName("handle_expanded").addClassName("handle_collapsed");}else{this.getHandle().style.backgroundImage="url("+window["base_uri"]+"/img/"+this.collapsedIcon()+")";}},onShowBlock:function(){if(this._cssOnly){this.getHandle().removeClassName("handle_collapsed").addClassName("handle_expanded");}else{this.getHandle().style.backgroundImage="url("+window["base_uri"]+"/img/"+this.expandedIcon()+")";}},collapsedIcon:function(){return(this.isRetina?"handle/blockCollapsed@2x.png":"handle/blockCollapsed.png");},expandedIcon:function(){return(this.isRetina?"handle/blockExpanded@2x.png":"handle/blockExpanded.png");},getBlockContentElement:function(){return $("btb"+this.blockId);},_deleteBlockData:function(){this._blocks={};},_addBlockData:function(){this._blocks["_"]=true;}});(function(a){a.fn.make_collapsable=function(b){b=b||{};var d=b["registerForExpandAll"];var c=b["onStateChange"]||Prototype.emptyFunction;this.each(function(){if(this._simple_block){return;}$(this).identify();this._simple_block=new BS.SimpleBlock(this,this.getAttribute("data-blockId"),this.getAttribute("data-collapsedByDefault"),c);if(d){BS.CollapsableBlocks.registerBlock(this._simple_block,d);}});return this;};})(jQuery);BS.SimpleBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a,d,c){this.elementId=b.identify();this.onStateChange=c;if(!a){a=this.elementId;}$super(a,"",d);},getId:function(){return this.elementId;},getHandle:function(){return $(this.elementId).down(".handle");},getBlockContentElement:function(a){if(!$(this.elementId)){BS.Log.warn("Cannot find block element "+this.elementId);}return $(this.elementId).next();},onShowBlock:function($super,a,b){$super(a,b);$(this.elementId).addClassName("exp");this.onStateChange($(this.elementId),true);},onHideBlock:function($super,a,b){$super(a,b);$(this.elementId).removeClassName("exp");this.onStateChange($(this.elementId),false);}});BS.MultilineBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a,c,d){if(typeof d==="undefined"){d=false;}this.mustPersistState=d;$super(b,a,c,true);},getBlockContentElement:function(){return jQuery('[id="btb'+this.blockId+'"]');}});BS.BuildTypeBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a,c){this._collapsedIcon=c;this.headerId=a+"-div";$super(b,a);},onShowBlock:function($super,a,b){$super(a,b);this.updateHeader(true);},onHideBlock:function($super,a,b){$super(a,b);this.updateHeader(false);},expandedIcon:function(){var a=this._collapsedIcon.replace("@2x","").replace(/\.png$/,"Expanded.png");if(this.isRetina){a=a.replace(/\.\w+$/,function(b){return"@2x"+b;});}return a;},collapsedIcon:function(){var a=this._collapsedIcon.replace("@2x","");if(this.isRetina){a=a.replace(/\.\w+$/,function(b){return"@2x"+b;});}return a;},updateHeader:function(b){var e=BS.Util.escapeId(this.headerId),d=$j(e);if(d.length){d.toggleClass("exp");var c=d.find(".problemsSummary");if(b){c.hide();}else{c.show();}if(!b&&!c.length&&BS.ProblemsSummary){var a=this.blockId;BS.ProblemsSummary.requestBuildTypeUpdate(a);}}else{BS.Log.info("Could not find element "+this.headerId);}}});BS.ProjectBlock=Class.create(BS.BlockWithHandle,{initialize:function($super,b,a,e,c,d){this._collapsedIcon=c;this.projectId=a.substr("ovr_".length);this.projectExternalId=e;$super(b,a,d);this.clickOnHeaderShouldToggle();this._initialized=true;},clickOnHeaderShouldToggle:function(){var a=$("p_"+this.projectId).down(".projectHeader");a.on("mousedown",function(b){Event.stop(b);});a.on("click",function(c){var b=Event.element(c);if(b.className.indexOf("handle")==-1&&b.tagName!="A"){this.toggle();Event.stop(c);}}.bindAsEventListener(this));},onShowBlock:function($super,b,d){var a=this.projectId;var c=this.projectExternalId;if(this._initialized&&BS.lazyLoadProject){BS.lazyLoadProject(a,c,!this.collapsedByDefault);}$super(b,d);jQuery("#ph_"+a).addClass("exp");},onHideBlock:function($super,b,c){$super(b,c);var a=this.projectId;jQuery("#ph_"+a).removeClass("exp");},expandedIcon:function(){var a=this._collapsedIcon.replace("@2x","").replace(/\.png$/,"Expanded.png");if(this.isRetina){a=a.replace(/\.\w+$/,function(b){return"@2x"+b;});}return a;},collapsedIcon:function(){var a=this._collapsedIcon.replace("@2x","");if(this.isRetina){a=a.replace(/\.\w+$/,function(b){return"@2x"+b;});}return a;}});;
/*---
/js/bs/changesBlock.js
---*/
BS.ChangeBlock=Class.create(BS.BlocksWithHeader,{initialize:function($super,a){$super(a);},getBlockContentElement:function(c){var b=$(c);if(!b||!b.parentNode){return;}$(b.parentNode).cleanWhitespace();var a=b.nextSibling.nextSibling;if(!a){alert("No contentDiv for "+b.id);}return a;}});;
/*---
/js/bs/collapseExpand.js
---*/
BS.CollapsableBlocks={registerBlock:function(c,a){var b=this._blocks(a);var d=c.getId();b[d]=c;},unregisterBlocks:function(a){if(a){delete this._allBlocks[a];}},collapseAll:function(a,b){var c=this._blocks(b);for(var d in c){if(!c.hasOwnProperty(d)){continue;}if(c[d].isExpanded(d)){c[d].changeState(d,true,false);if(a){c[d]._saveState();}}}return false;},expandAll:function(a,b){var c=this._blocks(b);for(var d in c){if(!c.hasOwnProperty(d)){continue;}if(!c[d].isExpanded(d)){c[d].changeState(d,true,true);if(a){c[d]._saveState();}}}return false;},_blocks:function(a){a=a||"default";this._allBlocks[a]=this._allBlocks[a]||{};return this._allBlocks[a];},_allBlocks:{}};;
/*---
/js/bs/pin.js
---*/
BS.Pin={noHover:false,_onBuildPage:false,pin:function(a){if(a){BS.Pin._onBuildPage=true;}BS.Pin.togglePin(true,"Unpin");},unpin:function(a){if(a){BS.Pin._onBuildPage=true;}BS.Pin.togglePin(false,"Pin");},togglePin:function(d,c){var a=BS.PinBuildDialog.formElement().buildId.value;var b=$("pinLink"+a);BS.Util.show("progressIcon"+a);BS.Util.hide(b);BS.FormSaver.save(BS.PinBuildDialog,BS.PinBuildDialog.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(f,g,e){$(b.parentNode).cleanWhitespace();BS.Util.hide("progressIcon"+a);BS.Util.show(b);BS.reload(true);},onFailure:function(){BS.Util.show(b);BS.Util.hide("progressIcon"+a);alert("Problem accessing server");}}));},showSuccessMessage:function(b,c){var d=$("pinLink"+b);var e=d.parentNode.parentNode;$(e).cleanWhitespace();for(var a=0;a<e.childNodes.length;a++){var f=e.childNodes[a];if(f.tagName=="TD"){if(c){f.style.backgroundColor="#FFFFCC";BS.Util.show("successMessage");$("successMessage").innerHTML="Pinned build won't be removed from the history list until you unpin it.";}else{f.style.backgroundColor="white";BS.Util.show("successMessage");$("successMessage").innerHTML="The build has been unpinned.";}BS.Util.hideSuccessMessages();$("successMessage").style.backgroundColor="#ffffcc";}}},installHover:function(d){if(BS.Pin.noHover){return;}$(d).cleanWhitespace();var b=d.id.substring("pinTd".length);var a=$("pinImg"+b);var c=$("pinLink"+b);BS.Util.hide(c);c.addClassName("unpinLink");d.on("mouseover",function(){BS.Util.show(c);});d.on("mouseout",function(){BS.Util.hide(c);});BS.Util.show(a);},uninstallHover:function(d){var b=d.id.substring("pinTd".length);var a=$("pinImg"+b);var c=$("pinLink"+b);if(c.className){c.removeClassName("unpinLink");}if(a.style){BS.Util.hide(a);}d.stopObserving();}};BS.PinBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("pinBuildForm");},getContainer:function(){return $("pinBuildFormDialog");},onText:"Pin",offText:"Unpin",appendTag:function(a){BS.Util.addWordToTextArea(this.formElement().buildTagsInfo,a);},showPinBuildDialog:function(e,c,a,b,d,f){this.formElement().buildId.value=e;var g=c?this.onText:this.offText;this.formElement().pin.value=c;this.formElement().PinSubmitButton.value=g;$("pinBuildFormTitle").innerHTML=g+" build";this.formElement().pinComment.value=d!=null&&d.length>0?d:this.formElement().pinComment.defaultValue;this.formElement().buildTagsInfo.value=a;$(this.formElement().id+"_availableTags").innerHTML="";if(f){$(this.formElement().id+"_availableTags").innerHTML=$(f).innerHTML;}if(b){$j("#pinBuildForm .tagsApplyAll").show();}this.showCentered();this.formElement().pinComment.focus();this.formElement().pinComment.select();this.bindCtrlEnterHandler(this.submit.bind(this));return false;},submit:function(){var b=this.formElement().onBuildPage.value=="true";if(this.formElement().pinComment.value==this.formElement().pinComment.defaultValue){this.formElement().pinComment.value="";}var a=this.formElement().pin.value=="true";if(a){BS.Pin.pin(b);}else{BS.Pin.unpin(b);}return false;}}));;
/*---
/js/bs/buildComment.js
---*/
BS.BuildCommentDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("buildCommentForm");},getContainer:function(){return $("buildCommentFormDialog");},showBuildCommentDialog:function(a,b){this.formElement().promotionId.value=a;var c=b!=null&&b.length>0;this.formElement().buildComment.value=c?b:this.formElement().buildComment.defaultValue;$("buildCommentFormTitle").innerHTML=c?"Change build comment":"Add build comment";this.showAtFixed($(this.getContainer()));$(this.formElement().buildComment).activate();this.bindCtrlEnterHandler(this.submit.bind(this));},submit:function(){if(this.formElement().buildComment.value==this.formElement().buildComment.defaultValue){this.formElement().buildComment.value="";}BS.Util.show("buildCommentProgressIcon");BS.FormSaver.save(BS.BuildCommentDialog,BS.BuildCommentDialog.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(b,c,a){BS.Util.hide("buildCommentProgressIcon");BS.reload(true);},onFailure:function(){BS.Util.hide("buildCommentProgressIcon");alert("Problem accessing server");}}));return false;}}));;
/*---
/js/bs/runningBuilds.js
---*/
BS.RunningBuilds={subscribeOnBuild:function(a){BS.SubscriptionManager.subscribe("rb/"+a,function(e){var b=JSON.parse(e);if(!b){return;}var d=b.a;var c=b.b;BS.RunningBuilds.processNode(b,d);if(BS.ProblemsSummary){BS.ProblemsSummary.requestBuildTypeUpdate(c);}});},unsubscribeFromBuild:function(a){BS.SubscriptionManager.unsubscribe("rb/"+a);},processNode:function(b,a){this.updateStatusIcon(b,a);this.updateDescription(b,a);this.updateDuration(b,a);this.updateProgress(b,a);this.updateArtifactsLink(b,a);this.updateBuildTypeStatus(b);},findNestedDiv:function(a){return $(a.getElementsByTagName("div")[0]);},updateStatusIcon:function(f,d){var e=$("build:"+d+":img");if(e){var g=f.d;var a=f.f;var c=e.src;if(a){if(g){c=c.replace("personalRunningFailing.gif","personalRunning.gif");}else{c=c.replace("personalRunning.gif","personalRunningFailing.gif");}}else{c=window["base_uri"]+"/img/buildStates/"+(g?"running_green_transparent.gif":"running_red_transparent.gif");}var b=e.src;if(b!=c&&b.replace(/@2x/,"")!=c){e.src=c;}BS.updateRetinaImage(e);}},updateDescription:function(c,a){var d=$("build:"+a+":text");if(d){var b=c.c;b=b.escapeHTML();if(b.length>100){b=b.substring(0,100)+"&hellip;";}d.innerHTML=b;}},updateDuration:function(c,b){var a=c.m;var d=$("build:"+b+":duration");if(d){d.innerHTML=a;}},updateProgress:function(b,a){this.doUpdateProgress(a,true,b.m,b.j,b.k,b.l,b.h,b.g,b.i,b.d,b.n);},doUpdateProgress:function(i,f,h,n,j,g,a,l,b,o,q){var k=$("build:"+i);if(k==null){return;}var p=k.select(".progress")[0];var m=k.select(".start_date")[0];if(p&&m){var r="Started: "+m.innerHTML+"<br>"+h+" passed";if(n){r+=" of "+n+" initially estimated";}var e=this.findNestedDiv(p);if(e){if("N/A"==j){if(f){e.style.width="100%";}}else{if(a){BS.Util.show($("build:"+i+":overtime_icon"));}else{BS.Util.hide($("build:"+i+":overtime_icon"));}if(b){r+="<br>"+(a?"more than ":"")+j+" left";}if(a){r+="<br>"+g+" overtime";}if(f){if(l){e=this.setTextInProgress(p,"overtime: "+g);}else{e=this.setTextInProgress(p,j+" left");}e.removeClassName("progressInnerSuccessful");e.removeClassName("progressInnerFailed");e.addClassName(o?"progressInnerSuccessful":"progressInnerFailed");e.style.width=q+"%";}}}var d=$("aLink:"+i);if(d&&d.innerHTML!=""){r+="<br>Agent: "+d.innerHTML;}var c=p.id;p._title=r;if(!p._eventsBound){k.on("mouseenter",function(){BS.Tooltip.showMessage($(c),{shift:{x:10,y:20}},$(c)._title);});k.on("mouseleave",function(){BS.Tooltip.hidePopup();});p._eventsBound=true;}}},setTextInProgress:function(a,c){var b="&nbsp;&nbsp;"+c.replace(/ /g,"&nbsp;");a.innerHTML=b+"<div class='progressInner'>"+b+"</div>";return this.findNestedDiv(a);},updateArtifactsLink:function(e,d){var a=e.o===true;if(a){var c=$("build:"+d+":artifactsLink");var b=$("build:"+d+":noArtifactsText");if(c&&b){c.style.display="inline";b.style.display="none";}}},updateBuildTypeStatus:function(c){var b=c.b;var a=$j("#mainNavigation").children(".buildType");if(a.attr("data-buildTypeId")==b){a.toggleClass("failed",!c.e);}}};;
/*---
/js/bs/systemProblemsMonitor.js
---*/
BS.SystemProblems={problemIds:{},_problemType:null,_options:{},_lastFailures:{},startUpdates:function(a){this._problemType=a;this.updateNow(true);},setOptions:function(a){this._options=a;},updateNow:function(f){var e=this;var c=this._options;var d=this._problemType;var a=this._options.perBranch;var b=BS.Branch.getAllBranchesFromUrl();var g=$j.extend({},b);g["getSystemProblems"]="true";if(d){g["problemType"]=d;}if(a){g["allProblems"]=true;}if(c.btId){g["btId"]=c.btId;}if(c.projectId){g["projectId"]=c.projectId;}if(c.overview){g["overview"]=true;}BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:g,evalScripts:false,onSuccess:function(n){try{var r=BS.Util.documentRoot(n);if(!r){return;}var j=r.childNodes;var k={};var p={};var o,m,h,l;BS.SystemProblems.cleanRemovedProblems();if(a){e._handleProblemsPerBranch(j,c.btId);return;}for(o=0;o<j.length;o++){m=j[o];h=m.getAttribute("id");k[h]=m.getAttribute("text");p[h]=parseInt(m.getAttribute("problemCount"));if(!k[h]){k[h]="Configuration problems found";}}for(l in e._lastFailures){if(k[l]===undefined){BS.SystemProblems.hideProblems(l);}}e._lastFailures=k;for(l in e._lastFailures){if(k[l]!==undefined){BS.SystemProblems.showProblems(l,k[l],p[l]);}}if(f){setTimeout(function(){e.updateNow(true);},BS.internalProperty("teamcity.ui.systemProblems.pollInterval")*1000);}}catch(q){BS.Log.warn(q);}}});},cleanRemovedProblems:function(){var b,a,c,d;for(b in BS.SystemProblems.problemIds){a=BS.SystemProblems.problemIds[b];d=[];if(a){for(c=0;c<a.length;c++){if($("buildType:"+a[c]+":systemProblems")){d.push(a[c]);}}if(d.length<a.length){BS.SystemProblems.problemIds[b]=d;}}}},hideProblems:function(b){var a=BS.SystemProblems.getProblemElements(b),c;for(c=0;c<a.length;c++){BS.Util.hide(a[c].problemElement);}if(BS.ProblemsSummary){BS.ProblemsSummary.requestBuildTypeUpdate(b);}},showProblems:function(c,a,e){var b=BS.SystemProblems.getProblemElements(c),d;for(d=0;d<b.length;d++){BS.SystemProblems.updateErrText(b[d].problemTextElement,a,e);BS.Util.show(b[d].problemElement);}if(BS.ProblemsSummary){BS.ProblemsSummary.hideSummaryFor(c);}},getProblemElements:function(b){var a=this.problemIds[b];if(a){return jQuery.map(a,function(c){return{problemElement:$("buildType:"+c+":systemProblems"),problemTextElement:$("buildType:"+c+":systemProblemsText")};});}else{return[];}},registerProblemId:function(a,c){var b=this.problemIds[a];if(b){b.push(c);}else{this.problemIds[a]=[c];}},updateErrText:function(c,a,d){if(!c){return;}a=a.escapeHTML();var b=parseInt(c.getAttribute("data-maxWidth"));c.title=a.length>b?a:"";if(a.length>b){a=a.substr(0,b)+"&hellip;";}if(d>1){a+=" (and "+(d-1)+" more)";}c.update(a);},_handleProblemsPerBranch:function(b,a){if(!b||!b.length){return;}this.hideProblems(a);var h=[];for(var d=0;d<b.length;d++){var c=b[d];var j=c.getAttribute("id");if(a!=j){continue;}var g=c.getAttribute("text")||"Configuration problems found";var f=c.getAttribute("additional");h[f]=g;}var e=this;$j(".systemProblemsBar[data-build-type='"+a+"']").each(function(){var i=this.getAttribute("data-branch");var k=h[i];if(k){$j(this).show();e.updateErrText($j(this).children(".systemProblemsBarText")[0],k,0);}});}};BS.SystemProblemsPopup=new BS.Popup("systemProblemDetails",{url:window["base_uri"]+"/systemProblems.html",method:"get",delay:0,hideDelay:-1});BS.SystemProblemsPopup.showDetails=function(a,d,c,g,b){if(this.isShown()){this.hidePopup();return;}var f="buildTypeId="+a;if(d!=null&&d!=""){f+="&problemType="+encodeURIComponent(d);}if(c!=null&&c!=""){f+="&problemSource="+encodeURIComponent(c);}var e=$j(b).parent().attr("data-branch");if(e!=null&&e!=undefined){if(e=="<default>"){e="";}f+="&additional="+encodeURIComponent(e);}f+="&showHead="+g;this.options.parameters=f;this.options.shift={x:0,y:b.parentNode.offsetHeight-2};this.showPopupNearElement(b.parentNode);};;
/*---
/js/bs/overflower.js
---*/
BS.Overflower=function(b,a){this.element=b;this.background="#ffffcc";if(typeof a!="undefined"){this.background=a;}};BS.Overflower.prototype.isOverflown=function(){var c=$(this.element);var d=[c.offsetWidth,c.offsetHeight];var b=c.getStyle("overflow");c.style.overflow=BS.Browser.msie?"visible":"auto";var a=[c.offsetWidth,c.offsetHeight];c.style.overflow=b;return(d[0]!=a[0]||d[1]!=a[1]);};BS.Overflower.prototype.installTooltip=function(){this.element.style.overflow="hidden";this.element.style.textOverflow="ellipsis";$(this.element).on("mouseover",function(){if(!this.isOverflown()){return;}if(!this.tooltip){var a=document.createElement("div");a.style.position="absolute";a.style.width="auto";a.style.height="auto";a.style.zIndex="300";if(this.background){a.style.backgroundColor=this.background;}$(a).on("mouseout",function(){this.style.display="none";}.bindAsEventListener(a));this.tooltip=a;this.element.parentNode.insertBefore(this.tooltip,this.element);}var b=$(this.element).positionedOffset();this.tooltip.style.left=b[0]+"px";this.tooltip.style.top=b[1]+"px";this.tooltip.innerHTML=this.element.innerHTML;this.tooltip.style.display="block";}.bindAsEventListener(this));};;
/*---
/js/bs/queueLikeSorter.js
---*/
BS.QueueLikeSorter={containerId:null,getActionUrl:function(){},getActionParameters:function(b,a){},afterOrderSaving:function(){},_timoutHandle:null,scheduleUpdate:function(b,a){this.updateMoveTopIcons();if(this._timoutHandle){clearTimeout(this._timoutHandle);}this._timoutHandle=setTimeout(this.saveOrder.bind(this,b,a),1000);},updateMoveTopIcons:function(){var a=$(this.containerId);if(!a){return;}var c=a.select(".moveTopIcon");if(!c){return;}for(var b=0;b<c.length;b++){if(c[b]==null){continue;}if(b==0){c[b].style.visibility="hidden";}else{c[b].style.visibility="";}}},saveOrder:function(c,a){if(!c){return;}this.setOrderSaving(true);var b=this;BS.ajaxRequest(b.getActionUrl(),{parameters:b.getActionParameters(c,a),onComplete:function(e,d){b.setOrderSaving(false);b.afterOrderSaving();}});},setOrderSaving:function(a){if(a){BS.Util.hide("dataSaved");BS.Util.show("savingData");}else{window.setTimeout(function(){BS.Util.hide("savingData");BS.Util.show("dataSaved");window.setTimeout(function(){BS.Util.hide("dataSaved");},3000);},1000);}},moveToTop:function(c){var b=$(c);var a=b.parentNode;if(a.firstChild.id==b.id){return;}a.removeChild(b);a.insertBefore(b,a.firstChild);this.scheduleUpdate(a);},computeOrder:function(d,f,b){var e=[];if(b){e=$("buildQueueTable").select(b);}else{if(d.childNodes&&d.childNodes.length>0){$(d).cleanWhitespace();e=d.childNodes;}}var a="";for(var c=0;c<e.length;c++){var g=e[c].id;if(g.indexOf(f)!=0){continue;}a+=e[c].id.substring(f.length)+";";}return a;}};;
/*---
/js/bs/buildQueue.js
---*/
if(!BS.Queue){BS.Queue=OO.extend(BS.QueueLikeSorter,{containerId:"buildQueueTable",personalBuilds:[],getActionUrl:function(){return window["base_uri"]+"/queue.html";},getActionParameters:function(b,a){return"queueOrder="+this.computeOrder(b,"queue_",a);},afterOrderSaving:function(){var a=$("buildQueueContainer");a.refresh();},scheduleUpdate:function(c,a,d){this.updateMoveTopIcons();if(this._timoutHandle){clearTimeout(this._timoutHandle);}var b=function(){this.saveOrder(c,a);d&&d();}.bind(this);this._timoutHandle=setTimeout(b,1000);}});}BS.Queue=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,_.extend(BS.Queue,{getContainer:function(){return $("removeFromQueueDialog");},formElement:function(){return $("removeFromQueue");},showRemoveDialog:function(a){this.formElement().removeFromQueue.value=a;this.formElement().comment.value=this.formElement().comment.defaultValue;this.showCentered();this.formElement().comment.focus();this.formElement().comment.select();this.bindCtrlEnterHandler(this.removeFromQueue.bind(this));},removeFromQueue:function(a){if(a){this.formElement().removeFromQueue.value=a;}if(this.formElement().comment.value==this.formElement().comment.defaultValue){this.formElement().comment.value="";}if(this.isVisible()){this.setOrderSaving(true);this.disable();}var b=this;BS.ajaxRequest(this.formElement().action,{parameters:this.serializeParameters(),onComplete:function(c){if(b.isVisible()){b.setOrderSaving(false);b.enable();b.close();}b.removeBuildTypeRow(b.formElement().removeFromQueue.value);if(BS.QueuedBuildsPopup&&BS.QueuedBuildsPopup.isShown()){BS.QueuedBuildsPopup.hidePopup();}}});return false;},removeBuildTypeRow:function(a){var e="queue_"+a;if(!$(e)){return;}var c=$(e).parentNode;c.removeChild($(e));var d=$j("#buildQueueTable tbody tr");if(d.length==0){$j("#buildQueueTable").remove();var b=$j("#notes");if(b!=undefined){b.html("<p>Build queue is empty.</p>");}return;}this.updateMoveTopIcons();BS.Queue.refreshEstimates();},refreshEstimates:function(){BS.Queue.requestNewQueueEstimates();},updateQueueEstimatesFromData:function(){for(var b in BS.QueueEstimates._estimates){var c=BS.QueueEstimates._estimates[b];var a=$("estimate"+b+":text");if(a){a.innerHTML=c!=null?c.getEstimate():"N/A";}}},requestNewQueueEstimates:function(){BS.ajaxRequest("queue.html?estimatesRequest=1",{onSuccess:function(b,a){b.responseText.evalScripts();BS.Queue.updateQueueEstimatesFromData();},method:"get"});},initEstimatesAutoupdate:function(){var a=function(){setTimeout(a,BS.internalProperty("teamcity.ui.buildQueueEstimates.pollInterval")*1000);BS.Queue.requestNewQueueEstimates();};a();},showBranchColumn:function(){if(this._branchShown){return;}$j("#buildQueueTable th.branch").addClass("hasBranch").html("Branch");this._branchShown=true;},showTagsColumn:function(){if(this._tagsShown){return;}$j("#buildQueueTable th.queuedBuildTags").addClass("hasTags").html("Tags");this._tagsShown=true;}})));BS.QueueFilter={filter:function(a){BS.QueueFilter._prepare();BS.QueueFilter._updateProperty(a,BS.QueueFilter._getValue($("queuePool")),{afterComplete:function(){$("buildQueueContainer").refresh();}});},resetFilter:function(a){BS.QueueFilter._prepare();BS.User.deleteProperty(a,{afterComplete:function(){$("buildQueueContainer").refresh();}});},_prepare:function(){BS.Util.show("queueFilterProgress");BS.Util.disableInputTemp($("queuePool"));},_getValue:function(a){return a.options[a.selectedIndex].value;},_updateProperty:function(b,c,a){if(c=="ALL"){BS.User.deleteProperty(b,a);}else{BS.User.setProperty(b,c,a);}}};BS.QueueEstimates={};BS.QueueEstimates._estimates={};BS.QueueEstimates.getEstimate=function(a){var b=this._estimates[a];if(b==null){return null;}return OO.extend(b,{getDescription:function(){var f="";if(this.secondsToStart==null){f="Cannot estimate this build<br/>";}else{if(this.secondsToStart>0){var e=this.getDurationAsString();if(e=="???"){e="";}else{e=" ("+e+")";}f=""+"Estimated start/finish: "+this.getTimeFrame()+e+"<br/>"+"Planned agent: "+this.getAgentLink()+"<br/>";}else{if(this.secondsToStart==0){f="The build should start shortly.<br/>";}}}if(this.isDelayed){var c=this.getBuildLink();var d=this.getAgentLink();if(c!=""&&d!=""){f+="Delayed by "+c+" on "+d+"<br/>";}f+="Expected build duration: "+this.getDurationAsString()+"<br/>";}if(this.getWaitReason()){f+="<em>"+this.getWaitReason()+"</em>";}return f;}});};$j(document).ready(function(){var g=function(i){var j=this.getAttribute("data-itemId");var k=BS.QueueEstimates.getEstimate(j);var h=k!=null?k.getDescription():"N/A";BS.Tooltip.showMessageAtCursor(i,{shift:{x:2,y:2}},h);};var e=function(){BS.Tooltip.hidePopup();};var c=function(){var h=BS.Util.getSelectedValues("buildQueueForm","removeItem");if(h.length>0){BS.blockRefreshPermanently();}else{BS.unblockRefresh();}};var b=function(){var h=$j(this).closest(".queueRowDragged");if(h.length>0){h.removeClass("queueRowDragged");return false;}return true;};var d="#buildQueueContainer td.remaining span.remaining, #queuedBuildsPopup td.remaining span.remaining, table.modificationBuilds td.remaining span.remaining";var a="#buildQueueContainer #removeItem, #buildQueueContainer #removeAll, #queuedBuildsPopup #removeItem, table.modificationBuilds #removeItem";var f="#buildQueueContainer #queueTableRows a, #queuedBuildsPopup #queueTableRows a";$j(document).on("mouseover",d,g).on("mouseout",d,e).on("click",a,c).on("click",f,b);});;
/*---
/js/bs/historyTable.js
---*/
BS.HistoryTable=OO.extend(BS.AbstractWebForm,{setSaving:function(b){var a=$("savingFilter");if(a){if(b){BS.Util.show(a);}else{BS.Util.hide(a);}}},formElement:function(){return $("historyFilter");},update:function(a){$j(function(){$("historyTable").refresh("savingFilter",a,function(){Form.enable(BS.HistoryTable.formElement());});});},doSearch:function(){BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.SimpleListener,{onBeginSave:function(a){Form.disable(a.formElement());a.setSaving(true);},onCompleteSave:function(){BS.HistoryTable.update();}}));return false;},setTagAndSearch:function(b,a){$j("form input[name="+a+"]").val(b||"");BS.HistoryTable.doSearch();return false;},resetTagAndSearch:function(){$j("form input[name=tag]").val("");$j("form input[name=privateTag]").val("");BS.HistoryTable.doSearch();return false;}});;
/*---
/js/bs/buildType.js
---*/
BS.BuildType={};BS.BuildType.updateView=function(){BS.reload(false,function(){$("buildConfigurationContainer").refresh();});};BS.BuildType.updateStatus=function(a){jQuery("#mainNavigation").children(".buildType").toggleClass("failed",a);};BS.BuildTypeResetSources=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("resetSources");},getContainer:function(){return $("resetSourcesDialog");},savingIndicator:function(){return $("resetSourcesProgress");},showResetSourcesDialog:function(){this.showCentered();this.bindCtrlEnterHandler(this.submitResetSources.bind(this));},submitResetSources:function(){if(this.formElement().agentId.selectedIndex==-1){alert("Please choose an agent.");return false;}var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(c,d,b){a.setSaving(false);a.enable();if(!b){a.close();BS.reload(true);}}}));return false;}}));BS.PauseBuildTypeDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("pauseBuildTypeForm");},getContainer:function(){return $("pauseBuildTypeFormDialog");},onText:"Pause",offText:"Activate",showPauseBuildTypeDialog:function(a,c,b){if(BS.bcActions_handle!=null){BS.bcActions_handle.hidePopup(0);}var d=c?this.onText:this.offText;if(c){BS.Util.show("removeFromQueue");BS.Util.show("lbl_removeFromQueue");}else{BS.Util.hide("removeFromQueue");BS.Util.hide("lbl_removeFromQueue");}this.formElement().pause.value=c;this.formElement().pauseBuildType.value=a;this.formElement().PauseSubmitButton.value=d;$("pauseBuildTypeFormTitle").innerHTML=d+" build configuration";this.formElement().pauseComment.value=b!=null&&b.length>0?b:this.formElement().pauseComment.defaultValue;this.showCentered();this.formElement().pauseComment.focus();this.formElement().pauseComment.select();this.bindCtrlEnterHandler(this.submit.bind(this));},submit:function(){if(this.formElement().pauseComment.value==this.formElement().pauseComment.defaultValue){this.formElement().pauseComment.value="";}BS.Util.show("pauseProgressIcon");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(b,c,a){BS.Util.hide("pauseProgressIcon");BS.reload(true);},onFailure:function(){BS.Util.hide("pauseProgressIcon");alert("Problem accessing server");}}));return false;}}));;
/*---
/js/bs/testGroup.js
---*/
BS.TestGroup={_data:{},_projectData:{},initialize:function(d,f,h){BS.TestGroup.initEventHandlers(d);if(!f){return;}var a=this._data[d]={};for(var c=0;c<f.length;++c){var e=f[c];if(!e){continue;}var b=e[0],g=e[1];a[b]=g;}this._projectData[d]=h||"_Root";},initEventHandlers:function(c){var d=jQuery(BS.Util.escapeId(c));var b=function(e){e.find("table.testList").each(function(){var g=jQuery(this);if(g.find("input").length==0){var f=g.prev();f.find(".multi-select").css({visibility:"hidden"});}});};var a=function(e){e.find("div.subgroups").each(function(){var g=jQuery(this);var h=true;g.find(".multi-select").each(function(){var i=jQuery(this);if(h&&i.css("visibility")!="hidden"){h=false;}});if(h){var f=g.prev();f.find(".multi-select").css({visibility:"hidden"});}});};b(d);a(d);d.on("click",".multi-select",function(i){var g=jQuery(this),f=g.parent().next(),h=g.find(".custom-checkbox_input").prop("checked"),e=f.find(".custom-checkbox").not(g);e.find(".custom-checkbox_input").prop("checked",!!h);e.change();});d.on("change","input[type=checkbox]",function(){var e=jQuery(BS.Util.escapeId(c)+"-actions-docked");var f=jQuery(this);_.delay(function(){var g=jQuery(BS.Util.escapeId(c)).find(".checkbox.custom-checkbox_checked").length>0;if(g){BS.blockRefreshPermanently("test");if(!e.is(":visible")){e.css("bottom","-100px").show().animate({bottom:0});}}else{BS.unblockRefresh("test");e.css({bottom:"-100px"}).hide();}var i=f.prop("checked");if(f.parent().hasClass("multi-select")){var h=f.closest(".group-name").next(".testList");h.toggleClass("testListSelected",i);if(!i){h.find(".testRowSelected").removeClass("testRowSelected");}}else{f.closest("tr").toggleClass("testRowSelected",i);}},10);});},findProjectIdByGroupId:function(a){return a?this._projectData[a]:null;},investigateSelected:function(c,d){var b=this._getSelectedData(c);if(b){this.hideError();var a=$j(c).attr("id");var e=a?this._projectData[a]:0;if(e){b["projectId"]=e;}BS.BulkInvestigateMuteTestDialog.show(b,d);}else{this.error(c,"Nothing is selected");}return false;},error:function(b,c){if(jQuery("#test-group-error").length==0){jQuery("body").append("<div class='successMessage' id='test-group-error'></div>");}jQuery("#test-group-error").html(c).css({position:"absolute",display:"block"}).position({my:"top",at:"top",of:jQuery(b),offset:"0 5"});var a=this;setTimeout(function(){a.hideError();},10000);},hideError:function(){jQuery("#test-group-error").fadeOut();},_getSelectedData:function(d){d=jQuery(d);var c=this._data[d.attr("id")];if(!c){alert("Failed to get tests group data");return null;}var a=d.find("div.group-div").filter(":visible").find(".custom-checkbox_checked").filter(":not(.multi-select)");if(a.length==0){return null;}var b={};a.each(function(){var e=jQuery(this);var f=e.find(".custom-checkbox_input").attr("data-testId");b[f]=c[f];});return b;},_getProjectExternalId:function(a){a=jQuery(a);return this._projectData[a.attr("id")];},highlight_multiple_bt_group:function(c,e){var d=$(c).up("div.group-div");d.down("div")._simple_block.changeState("",true,true);var a=d.select("div.subgroups div.group-name");for(var b=0;b<a.length;b++){var f=a[b];if(f.getAttribute("data-blockId")==e){new Effect.ScrollTo(f);f.highlight({duration:2});return;}}},regroup:function(b,f,a){BS.User.setSessionProperty(f,a.options[a.selectedIndex].value);BS.CollapsableBlocks.unregisterBlocks("expand_"+b);var e=jQuery(BS.Util.escapeId(b)),d=this.saveState(e),c=this;$(b+"Refresh").refresh(b+"_loading",null,function(){e=jQuery(BS.Util.escapeId(b));c.restoreState(e,d);});return true;},saveState:function(a){return{selected:_.keys(this._getSelectedData(a)||{})};},restoreState:function(d,c){var b=c.selected;for(var a=0;a<b.length;++a){d.find("input[data-testId="+b[a]+"]").prop("checked",true).parent().change();}},toggleSelectAll:function(b,e){var f=jQuery(b),a=f.find(".custom-checkbox");var c=jQuery(e),d=c.prop("checked");a.find(".custom-checkbox_input").not(c).prop("checked",!!d);a.not(c.parent()).change();}};;